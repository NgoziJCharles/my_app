<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js for the line chart sparkle -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style> /*opens inline CSS block*/
    :root{ /*starts a rule book*/
      --bg:#0b1220; /*background color*/    
      --panel:#111827; /*defines slightly lighter dark color than page background for contrast between layers*/    
      --panel-2:#0f172a;     
      --ink:#e5e7eb; /*variable for main text color*/    
      --muted:#94a3b8; /*var for secondary text*/ 
      --accent:#06b6d4; /*CSS var for brand accent color | used for highlights*/ 
      --accent-ink:#0ea5b8; 
      --ring:rgba(14,165,233,.35); /*semi-trans color for focus outlines | RGBA keeps hue but often softens it with alpha*/
      --success:#22c55e; /*var for success/okay messages*/
    }
    *{box-sizing:border-box} /* '*' = universal selector; applies to every element*/
    html,body{height:100%} /*CSS rule for both html and body | sets height to full viewport*/
    body{
      margin:0; /*removes browser's default origin margin on body*/
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      /*font stack (ordered list of fallbacks) | uses Inter if loaded otherwise falls back to the OS/UI fonts*/
      color:var(--ink); /*sets default text color using the --ink var*/
      background:radial-gradient(1200px 800px at 10% -10%, #0e1b2c 0%, #0b1220 55%) fixed;
      /*paints radial gradient behind paged; fixed = doesn't scroll*/
    }

    .shell{ /*the dot means "class" | starts style block that applies to any element with class="shell"*/
      min-height:100vh; 
      display:grid; /*analogy: draw an invisble grid so we can place things in neat cols*/
      grid-template-columns: 260px 1fr; /*defines 2 grid cols: first=260px wide: second=1fr (1 fraction of remaining space)*/
    }
    .sidebar{ /*about to style the left navigation col*/
      background:var(--panel);
      border-right:1px solid rgba(255,255,255,.06); /*draws right-side border | creates subtle divider between sidebar and main area*/
      position:sticky; top:0; height:100vh; padding:18px 16px; /*sticky: element sticks to a pos while scrolling | 
      keeps sidebar visible at top as page scrolls*/
    }
    .brand{font-weight:700; letter-spacing:.5px; color:var(--accent); font-size:18px; margin-bottom:12px}
    /*styles any element with class brand | fw: bold, ls: tiny spacing between letters | makes "project hub" stand out in sidebar*/
    .nav a{ /*targets <a> links inside an element with class .nav*/
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; margin:4px 0; border-radius:10px;
      color:var(--ink); text-decoration:none;
    }
    .nav a:hover{ background:rgba(14,165,233,.10); color:var(--accent) }

    .main{
      display:grid; grid-template-rows: auto 1fr;
      min-height:100vh;
    }
    .topbar{
      background:var(--panel-2);
      border-bottom:1px solid rgba(255,255,255,.06);
      padding:12px 18px; display:flex; align-items:center; justify-content:space-between;
    }
    .hello{color:var(--muted); font-size:14px}

    .content{
      padding:22px; max-width:1200px; width:100%;
    }

    /* ====== CARDS & GRIDS ====== */
    .grid-3{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:16px;
    }
    .card{
      background:var(--panel);
      border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:16px;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .card h3{ margin:0 0 8px 0; font-size:14px; color:var(--muted); font-weight:600 }
    .big{ font-size:28px; font-weight:700 }

    .section{ margin-top:18px }
    .section h2{ margin:0 0 10px 0; font-size:18px; color:var(--ink) }

    /* Profile key/value layout */
    .kv{ display:grid; grid-template-columns: 120px 1fr; row-gap:10px; column-gap:14px }
    .kv .k{ color:var(--muted); font-weight:600 }
    .kv .v{ color:var(--ink) }

    /* Projects list */
    .projects{ list-style:none; margin:0; padding:0 }
    .projects li{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 12px; border:1px solid rgba(255,255,255,.06);
      background:rgba(255,255,255,.02); border-radius:10px; margin-bottom:10px;
    }
    .tag{
      font-size:12px; padding:4px 8px; border-radius:999px;
      background:rgba(14,165,233,.12); color:var(--accent); border:1px solid rgba(14,165,233,.25);
    }

    .link-btn{background:transparent;border:1px solid rgba(255,255,255,.18);border-radius:8px;padding:6px 10px;font-size:12px;color:var(--ink);cursor:pointer}
    .link-btn:hover{border-color:rgba(255,255,255,.35)}
    .link-btn.danger{border-color:rgba(239,68,68,.5);color:#ef4444}
    .link-row{display:flex;align-items:center;gap:8px}

    .status-ok{color:#22c55e}
    .status-bad{color:#ef4444}
    .status-muted{color:var(--muted)}

    /* Responsive */
    @media (max-width: 980px){ .grid-3{ grid-template-columns: 1fr 1fr } }
    @media (max-width: 760px){
      .shell{ grid-template-columns: 1fr }  /* hide sidebar by stacking (simple) */
      .sidebar{ position:static; height:auto }
      .kv{ grid-template-columns: 1fr }
      .grid-3{ grid-template-columns: 1fr }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <div class="brand">PROJECT HUB</div>
      <nav class="nav">
        <a href="{{ url_for('dash.dashboard_home') }}">üè† Dashboard</a>
        <a id="nav-notifications" href="{{ url_for('dash.notifications') }}">üîî Notifications</a>
        <a href="{{ url_for('auth.logout') }}">‚Ü©Ô∏é Logout</a>
      </nav>
    </aside>

    <!-- ===== Main ===== -->
    <div class="main">
      <!-- Top bar -->
      <header class="topbar">
        <div style="font-weight:700">Dashboard</div>
        <div class="hello">Hi, {{ session.get('username','user') }}</div>
      </header>

      <!-- Content -->
      <main class="content">
        <!-- KPI cards (recruiter eye-candy) -->
        <div class="grid-3">
          <div class="card">
            <h3>Total Projects</h3>
            <div class="big">{{ projects|length }}</div>
          </div>
          <div class="card">
            <h3>Active Stage</h3>
            <div class="big">
              {% if projects %}
                {{ stage_labels.get(projects[0].stage, 'Unknown') }}
              {% else %}-{% endif %}
            </div>
          </div>
          <div class="card">
            <h3>Status</h3>
            <div class="big {{ status_class }}">{{ status_text }}</div>
            <div style="font-size:12px; color:var(--muted); margin-top:4px;">
              Avg stage: {{ '%.2f'|format(avg_stage) if avg_stage is not none else '-' }}
            </div>
          </div>          
        </div>

        <!-- Profile!!!! -->
        <section class="section">
          <div class="card">
            <h2>Profile</h2>
            <div class="kv">
              <div class="k">Name</div>    <div class="v">{{ customer.name   if customer else '-' }}</div>
              <div class="k">Phone</div>   <div class="v">{{ customer.phone  if customer else '-' }}</div>
              <div class="k">Address</div> <div class="v">{{ customer.address if customer else '-' }}</div>
            </div>
          </div>
        </section>

        <!-- Projects -->
        <section class="section">
          <div class="card">
            <h2>Projects</h2>
            <form action="{{url_for('dash.create_project')}}" method="post" id="project-form" style="display:flex; gap:8px; align-items:flex-end; margin:12px 0;">
              <div style="flex:1;">
                <label for="proj-name">Name</label>
                <input id="proj-name" name="name" type="text" required style="width:100%; padding:8px 10px; border:1px solid var(--primary); border-radius:10px;">
              </div>
              <div>
                <label for="proj-stage">Stage</label>
                <select id="proj-stage" name="stage" required style="padding:8px 10px; border:1px solid var(--primary); border-radius:10px;">
                  <option value="" disabled selected>Choose stage‚Ä¶</option>
                  <option value="1">Stage 1</option>
                  <option value="2">Stage 2</option>
                  <option value="3">Stage 3</option>
                  <option value="4">Stage 4</option>
                  <option value="5">Stage 5</option>
                  <option value="6">Stage 6</option>
                </select>
                <button type="submit" style="margin-left:8px; padding:8px 12px; background:transparent; color:var(--primary); border:2px solid var(--primary); border-radius:8px; font-weight:600; cursor:pointer;">Add</button>
              </div>
            </form>
            <hr style="border:none; border-top:1px solid var(--primary); opacity:.3; margin:10px 0;">
            <ul class="projects">
              {% if projects %}
                {% for p in projects %}
                <li>
                  <div style="font-weight:600">{{ p.name }}</div>
                  <div class="link-row">
                    <span class="tag">{{ stage_labels.get(p.stage, 'Unknown') }}</span>
                    <button type="button" class="link-btn" data-edit="{{ p.id }}">Edit</button>
                    <form action="{{ url_for('dash.delete_project', project_id=p.id) }}" method="post" style="display:inline" class="delete-form">
                    <button type="submit" class="link-btn danger">Delete</button>
                    </form>
                  </div>
                  <form class="edit-form" data-name="{{ p.name }}" data-stage="{{ p.stage }}" action="{{ url_for('dash.edit_project', project_id=p.id) }}" method="post" style="display:none; margin-top:10px; gap:8px; align-items:flex-end;">
                    <input name="name" type="text" value="{{ p.name }}" style="flex:1; padding:8px 10px; border:1px solid var(--primary); border-radius:10px;">
                    <select name="stage" style="padding:8px 10px; border:1px solid var(--primary); border-radius:10px;">
                      <option value="1" {{ 'selected' if p.stage==1 else '' }}>Stage 1</option>
                      <option value="2" {{ 'selected' if p.stage==2 else '' }}>Stage 2</option>
                      <option value="3" {{ 'selected' if p.stage==3 else '' }}>Stage 3</option>
                      <option value="4" {{ 'selected' if p.stage==4 else '' }}>Stage 4</option>
                      <option value="5" {{ 'selected' if p.stage==5 else '' }}>Stage 5</option>
                      <option value="6" {{ 'selected' if p.stage==6 else '' }}>Stage 6</option>
                    </select>
                    <button type="submit" class="link-btn">Save</button>
                    <button type="button" class="link-btn" data-cancel="{{ p.id }}">Cancel</button>
                  </form>                  
                </li>                
                {% endfor %}
                {% else %}
                <li><div>No projects yet.</div></li>
              {% endif %}
            </ul>
          </div>
        </section>

        <section class="section">
          <div class="card">
            <h2>Activity</h2>
            <canvas id="trend" height="100"></canvas>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    const ctx = document.getElementById('trend');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'],
        datasets: [{
          label: 'Updates',
          data: [3,4,2,6,8,7,9,11],               
          borderColor: getComputedStyle(document.documentElement)
                        .getPropertyValue('--accent').trim(),
          backgroundColor: 'rgba(14,165,233,.18)',
          fill: true, tension: .35, pointRadius: 0, borderWidth: 2
        }]
      },
      options: {
        plugins:{ legend:{ display:false } },
        scales:{
          x:{ ticks:{ color:'#9CA3AF' }, grid:{ color:'rgba(255,255,255,.06)' } },
          y:{ ticks:{ color:'#9CA3AF' }, grid:{ color:'rgba(255,255,255,.06)' } }
        }
      }
    });
  </script>
  <script>
    document.addEventListener('submit', (e) => {
      if (!e.target.matches('form.delete-form')) return;
      if (!confirm('Are you sure you want to delete this project?')) e.preventDefault();
    });
  </script>    
  <script>
  document.addEventListener('click', (e) => {
    if (e.target.matches('[data-edit]')) { const li=e.target.closest('li'); li.querySelector('.link-row').style.display='none'; li.querySelector('.edit-form').style.display='flex'; }
    if (e.target.matches('[data-cancel]')) {
      const li   = e.target.closest('li');
      const form = li.querySelector('.edit-form');
      form.querySelector('[name="name"]').value  = form.dataset.name;
      form.querySelector('[name="stage"]').value = form.dataset.stage;
      form.style.display = 'none';
      li.querySelector('.link-row').style.display = '';}
  });
  </script>  
</body>
</html>
